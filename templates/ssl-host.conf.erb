# This file is managed with Chef. For changes to persist, edit http_platform/templates/ssl-host.conf.erb

ServerAdmin <%= node['http_platform']['admin_email'] %>
DocumentRoot <%= node['http_platform']['www']['document_root'] %>

SSLEngine on
SSLCertificateFile <%= @path_to_cert %>
SSLCertificateKeyFile <%= @path_to_key %>

#SSLCertificateChainFile /etc/apache2/ssl.crt/server-ca.crt

#SSLCACertificatePath /etc/ssl/certs/
#SSLCACertificateFile /etc/apache2/ssl.crt/ca-bundle.crt

#SSLCARevocationPath /etc/apache2/ssl.crl/
#SSLCARevocationFile /etc/apache2/ssl.crl/ca-bundle.crl

# Types are none, optional, require and optional_no_ca.
#SSLVerifyClient require
#SSLVerifyDepth 10

# Set various options for the SSL engine.
#SSLOptions +StrictRequire +SSLRequireSSL
<% unless node['http_platform']['www']['rewrite_rules'].empty? -%>

RewriteEngine on
<% end -%>
<% node['http_platform']['www']['rewrite_rules'].each do |rule| -%>
<% if rule.key?('comment') && rule['comment'] -%><%= rule['comment'] %><% end -%>
RewriteRule <%= rule['url_regex'] %> <%= rule['path_regex'] %><% if rule.key?('flags') && rule['flags'] -%> <%= rule['flags'] %><% end -%>
<% end -%>

<% node['http_platform']['www']['access_directories'].each do |dir, _| -%>
<Directory <%= dir %>>
  Require all granted
</Directory>
<% end -%>

<% node['http_platform']['www']['error_documents'].each do |status, path| -%>
ErrorDocument <%= status %> <%= path %>
<% end -%>

<FilesMatch "\.(cgi|shtml|phtml|php)$">
  SSLOptions +StdEnvVars
</FilesMatch>

<Directory /usr/lib/cgi-bin>
  SSLOptions +StdEnvVars
</Directory>

<IfModule mod_php.c>
  <FilesMatch "\.php$">
    SetHandler application/x-httpd-php
  </FilesMatch>
</IfModule>
