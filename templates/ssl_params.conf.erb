# This file is managed with Chef. For changes to persist, edit secure_apache/templates/ssl_params.erb

SSLCipherSuite <%= node['secure_apache']['cert']['cipher_string'] %>
SSLProtocol <%= node['secure_apache']['cert']['protocol_string'] %>
SSLHonorCipherOrder On

# This requires a valid certificate
# HSTS (mod_headers is required) (15768000 seconds = 6 months)
Header always set Strict-Transport-Security "max-age=15768000; includeSubdomains"
#; preload

Header always set Referrer-Policy "no-referrer"
Header always set X-Frame-Options DENY
Header always set X-Content-Type-Options nosniff
Header always set X-XSS-Protection "1; mode=block"

Header always set Content-Security-Policy "base-uri 'none'"
Header always set Content-Security-Policy "default-src 'none'"
Header always set Content-Security-Policy "script-src 'strict-dynamic' 'nonce-MttToBeCode'"

# How to implement this?
# Header always set Content-Security-Policy "report-uri /some-report-uri"

# Requires Apache >= 2.4
SSLCompression off
SSLSessionTickets Off

# OCSP Stapling, only in httpd 2.3.3 and later
# Do not enable this without a CA cert
SSLUseStapling <%= node['secure_apache']['www']['use_stapling'] %>
SSLStaplingResponderTimeout 5
SSLStaplingReturnResponderErrors off

# This path is Ubuntu-specific
SSLStaplingCache shmcb:${APACHE_RUN_DIR}/ssl_stapling(32768)
# shmcb:/var/run/ocsp(32768)

SSLOpenSSLConfCmd DHParameters <%= node['secure_apache']['cert']['cert_public_directory'] %><%= node['secure_apache']['cert']['dh_param']['dh_param_file_name'] %>
