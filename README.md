# HTTP Platform Cookbook

__Maintainer: OIT Systems Engineering__ (<ua-oit-se@alaska.edu>)

## Purpose

Configures an HTTPS server with a certificate and secure cypher and protocol suites.
This cookbook configures only frontend nodes; load balancers, proxies, backends and everything else is out of scope.
Custom conf files can be injected to add such things as needed.

This cookbook is intended as a base for rapidly building websites and as such favors convention over configuration.

* Every host _redirects_ HTTP requests to HTTPS
* Multiple host names are supported, but hosts are little more than name aliases
* Host share these attributes
  * Certificate - all host names are listed as subject alternative names on the certificate
  * Redirects - these are generated per hostname
  * Rewrite rules - these are generated per hostname
  * Error documents
  * Configs
  * Content (root and access directories)
* Host are distinguished by
  * Log files
  * Log levels

Currently only Apache is supported.

Host names are always populated as plain-www pairs, so either or both can be listed.

Three sources are supported for certificates.
The cookbook always creates a private key, Self-Signed (SS) certificate, and Certificate Signing Request (CSR).
By default, the hosts are configured to use the SS certificate for encryption.

A trusted certificate can also be fetched from Lets Encrypt.
This method uses the Certbot utility to complete an ACME challenge from the certificate authority so the server must be world visible to use this method.

Lastly, a certificate can be fetched from the Chef server as a Vault secret.
Typically, the CSR generated by this cookbook will be sent to a certificate authority to obtain a trusted certificate.
Otherwise, if a key-CSR pair is generated by other means, the private key can be included in the vault item and used for encryption.

If multiple certificates are configured, the hosts will use the certificate with highest precedence.
Precedence is as follows.

`Vault > Lets Encrypt > Self Signed`

## Requirements

### Chef

This cookbook requires Chef 14+

### Platforms

Supported Platform Families:

* Debian
  * Ubuntu, Mint
* Red Hat Enterprise Linux
  * Amazon, CentOS, Oracle

Platforms validated via Test Kitchen:

* Ubuntu
* CentOS

### Dependencies

This cookbook does not constrain its dependencies because it is intended as a utility library.  It should ultimately be used within a wrapper cookbook.

## Resources

This cookbook provides no custom resources.

## Recipes

### http_platform::default

This recipe configures the server, encryption, hosts, and access.
Several additional recipes are called to accomplish these tasks, but only this recipe should be included by clients.

#### Attributes

__default__

Default attributes control the features of the platform.

__apache__

Apache attributes control the server configuration.

__cert__

Cert attributes specify the fields of the PKI certificate and the private key.

__firewall__

Firewall attributes configure the firewall settings.

__www__

WWW settings configure the application and hosts.

## Examples

This is an application cookbook; no custom resources are provided.  See recipes and attributes for details of what this cookbook does.

## Development

See CONTRIBUTING.md and TESTING.md.
